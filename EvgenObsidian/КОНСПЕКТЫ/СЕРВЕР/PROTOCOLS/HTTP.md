HTTP (HyperText Transfer Protocol) - это протокол прикладного уровня в стеке протоколов [[Эталонная модель OSI |OSI]] и модели [[Эталонная модель TCP IP|TCP/IP]] передачи гипертекста, который используется для передачи данных веб-страниц между веб-сервером и веб-клиентом, таким как веб-браузер. Это основной протокол для обмена данными в `WEB`. `HTTP` работает по модели "клиент-сервер", где клиент отправляет запросы на сервер, а сервер отвечает на эти запросы, предоставляя запрошенные ресурсы, такие как страницы HTML, изображения, видео, файлы и другие данные.

Он определяет, какие сообщения клиент может отсылать на серверы и какие получать ответы. Заголовки запросов и ответов даны в `ASCII`. Их содержимое задано в формате, похожем на `MIME`. Обычный способ взаимодействия браузера с сервером заключается в установке [[TCP, UDP|TCP]] соединения с портом 80 сервера, хотя формально эта процедура не является обязательной. Ценность использования TCP в том, что ни браузерам, ни серверам не приходится  беспокоиться о том, что делать со слишком длинными сообщениями, надежностью и контролем перегрузки. Все это обеспечивается протоколом [[TCP, UDP|TCP]]. 

### HTTP 1.1

Ранее, в `HTTP 1.0` после установки соединения посылался один запрос, на который приходил один ответ. После этого [[TCP, UDP|TCP]]-соединение разрывалось. В то время типичная веб-страница целиком состояла из HTML-текста, и такой способ взаимодействия был адекватным. Однако вскоре средняя веб-страница стала изобиловать большим количеством ссылок на различные значки и другие украшения. Очевидно, что установка [[TCP, UDP|TCP]]-соединения для передачи одного значка оказалась нерациональной и слишком дорогой. Это соображение привело к созданию протокола `HTTP 1.1`, который поддерживал постоянные соединения. Это означало, что появилась возможность установки [[TCP, UDP|TCP]]-соединения, отправки запроса, получения ответа, а затем передачи и приема дополнительных запросов и ответов. Эта стратегия называется `connection reuse` (повторное использование соединения). Таким образом, снизились накладные расходы, возникавшие при постоянных установках и разрывах соединения. Стало возможным также конвейеризировать запросы, то есть отправлять запрос 2 еще до прибытия ответа на запрос 1. 

![[Снимок экрана 2024-04-08 173631.png]]
 _а_ - множественные соединения и последовательные запросы;
 _б_ - постоянное соединение и последовательные запросы;
 _в_ - постоянное соединение и конвейерные запросы;

### HTTP 2.0

Главная цель разработки новой версии `HTTP` заключалась в обеспечении трёх свойств, которые редко ассоциируются с одним лишь сетевым протоколом, без необходимости использования дополнительных сетевых технологий, — простота, высокая производительность и устойчивость. Эти свойства обеспечены благодаря уменьшению задержек при обработке браузерных запросов с помощью таких мер, как `мультиплексирование`, `сжатие`, `приоритезация запросов` и `отправка данных по инициативе сервера` (Server Push).  
#### Мультиплексированные потоки

Пересылаемая через `HTTP/2` в обе стороны последовательность текстовых фреймов, которыми обмениваются между собой клиент и сервер, называется “потоком”. В ранних версиях `HTTP` можно было транслировать только по одному потоку за раз, с небольшой задержкой между разными потоками. Для решение этой проблемы в `HTTP/2` применяется новый бинарный слой фреймов.  
  
Этот слой позволяет превратить данные, передаваемые от сервера к клиенту, в управляемую последовательность маленьких независимых фреймов. И при получении всего набора фреймов клиент может восстановить передаваемые данные в исходном виде. Эта схема работает и при передаче в обратном направлении — от клиента к серверу.  
  
![](https://habrastorage.org/r/w1560/files/ff2/294/cd3/ff2294cd3c354af798a1cd445c685a92.png)  

#### Server Push

Эта возможность позволяет серверу отправлять клиенту дополнительную кэшируемую информацию, которую тот не запрашивал, но которая может понадобиться при будущих запросах. Например, если клиент запрашивает ресурс Х, который ссылается на ресурс Y, то сервер может передать Y вместе с Х, не дожидаясь от клиента дополнительного запроса.    
  
Полученный от сервера ресурс Y кэшируется на клиенте для будущего использования. Этот механизм позволяет экономить циклы «запрос-ответ» и снижает сетевую задержку. 
  
#### Бинарный формат

Для завершения циклов запрос-отклик `HTTP 1.x` обрабатывает текстовые команды. `HTTP/2` решает те же задачи с помощью бинарного формата. Это облегчает работу с фреймами и упрощает реализацию команд, которые могли путать из-за того, что они состоят из текста и необязательных пробелов.  
  
Браузеры, использующие `HTTP/2`, перед отправкой в сеть конвертируют текстовые команды в двоичные. Двоичный слой фреймов не имеет обратной совместимости с клиентами и серверами, использующими `HTTP 1.x`. 

Преимущества использования бинарного формата:  

- Низкие накладные расходы при парсинге данных 
- Ниже вероятность ошибок.
- Решение проблем с безопасностью, наподобие атак с разделением запросов (`response splitting attack`), проистекающих из текстовой природы `HTTP 1.x`.
- Выше эффективность и устойчивость к сбоям при обработке данных, передаваемых между клиентом и сервером.
- Снижение сетевой задержки и повышение пропускной способности.

#### Приоритезация потоков

`HTTP/2` позволяет клиенту отдавать предпочтения конкретным потокам данных. Приоритезация осуществляется с помощью присваивания каждому потоку зависимостей (`Dependencies`) и веса (`Weight`). Хотя все потоки, по сути, и так зависят друг от друга, ещё добавляется присваивание веса в диапазоне от 1 до 256. 
  
Приоритезация помогает разделять одновременно приходящие на сервер запросы в соответствии с потребностями конечных пользователей. А обработка потоков данных в случайном порядке только подрывает эффективность и удобство HTTP/2. В то же время, продуманны и широко распространённый механизм приоритезации потоков даст нам следующие преимущества:  
  
- Эффективное использование сетевых ресурсов.
- Снижение времени доставки запросов первичного контента.
- Повышение скорости загрузки страниц.
- Оптимизация передачи данных между клиентом и сервером.
- Снижение отрицательного эффекта от сетевых задержек.

#### Сжатие заголовков с сохранением состояния
  
`HTTP` — это протокол без сохранения состояния, то есть каждый клиентский запрос должен содержать как можно больше информации, необходимой серверу для выполнения соответствующей операции. В результате потоки данных содержат многочисленные повторяющиеся фреймы, потому что сервер не должен хранить информацию из предыдущих клиентских запросов.  
  
Если веб-сайт содержит много медиа-контента, то клиент отправляет кучу практически одинаковых фреймов с заголовками, что увеличивает задержку и приводит к избыточному потреблению сетевых ресурсов. В `HTTP/2` это решается с помощью сжатия большого количества избыточных фреймов с заголовками. Сжатие осуществляется с помощью алгоритма `HPACK`. Клиент и сервер хранят список заголовков, использовавшихся в предыдущих запросах.  
  
`HPACK` сжимает значение каждого заголовка перед отправкой на сервер, который потом ищет зашифрованную информацию в списке ранее полученных значений, чтобы восстановить полные данные о заголовке. Сжатие с помощью `HPACK` даёт невероятные преимущества с точки зрения производительности, а также обеспечивает:  
  
- Эффективную приоритезацию потоков.
- Эффективное использование механизмов мультиплексирования.
- Снижает накладные расходы при использовании ресурсов. Это один из первых вопросов, обсуждаемых при сравнении `HTTP/2` с `HTTP 1`.
- Кодирование больших и часто используемых заголовков, что позволяет не отправлять весь фрейм с заголовком. Передаваемый размер каждого потока быстро уменьшается.
- Устойчивость к атакам, например, `CRIME` — эксплойтам потоков данных со сжатыми заголовками.

### Методы

Несмотря на то что HTTP был разработан специально для использования в веб технологиях, он был намеренно сделан более универсальным, чем это было необходимо, так как рассчитывался на будущее применение в объектно-ориентированных приложениях. По этой причине в дополнение к обычным запросам веб-страниц были разработаны специальные операции, называемые методами. Они обязаны своим существованием технологии [[SOAP|SOAP]]. Каждый запрос состоит из одной или нескольких строк `ASCII-текста`, причем первое слово в первой строке является именем вызываемого метода. Имена методов чувствительны к регистру символов, то есть метод `GET` существует, а get — нет. 

#### Встроенные методы HTTP-запросов

- `GET` - Запрос чтения веб-страницы 
- `HEAD` - Запрос чтения заголовка веб-страницы 
- `PUT` - Запрос сохранения веб-страницы 
- `POST` - Добавить к именованному ресурсу (например, к веб-странице) 
- `DELETE` - Удалить веб-страницу 
- `TRACE` - Отобразить входящий запрос 
- `CONNECT` - Зарезервирован для будущего использования 
- `OPTIONS` - Опрос определенных параметров 

`Метод GET` запрашивает у сервера страницу (под которой в общем случае подразумевается объект, но на практике обычно это просто файл), закодированную согласно стандарту MIME. 

>Большую часть запросов к серверу составляют именно запросы `GET`. Вот самая типичная форма GET: `GET filename HTTP/1.1` где `filename` указывает на запрашиваемую страницу, а 1.1 — на используемую версию протокола. 

`Метод HEAD` просто запрашивает заголовок сообщения, без самой страницы. С помощью этого метода можно собрать индексную информацию или просто проверить работоспособность данного URL. 

`Метод POST` используется, когда подтверждаются формы. Он, так же как и метод `GET`, используется для веб-сервисов [[SOAP|SOAP]]. В нем также хранится URL, но вместо того, чтобы просто найти страницу, он передает данные на сервер (то есть содержимое формы или параметры [[RPC, gRPC|RPC, gRPC]]). Затем сервер в зависимости от URL что-то делает с этими данными, обычно прикрепляет их к объекту. В результате может быть, к примеру, что-то продано или вызвана процедура. Наконец, метод возвращает страницу с полученным результатом. Оставшиеся методы редко используются для просмотра сетевых ресурсов. 

`Метод PUT` является противоположностью метода `GET`: он не читает, а записывает страницу. Этот метод позволяет создать набор веб-страниц на удаленном сервере. Тело запроса содержит страницу. Она может быть закодирована с помощью `MIME`. В этом случае строки, следующие за командой `PUT`, могут включать различные заголовки, например заголовки аутентификации, подтверждающие права абонента на запрашиваемую операцию. 

`Метод DELETE`, что неудивительно, удаляет страницу или, по крайней мере, указывает на то, что веб-сервер удалит страницу. Как и в методе `PUT`, здесь особую роль могут играть аутентификация и разрешение на выполнение этой операции. 

`Метод TRACE` предназначен для отладки. Он приказывает серверу отослать назад запрос. Этот метод особенно полезен, когда запросы обрабатываются некорректно и клиенту хочется узнать, что за запрос реально получает сервер. 

`Метод CONNECT` позволяет пользователю подключиться к серверу через устройство-посредник, такое как веб-кэш. 

`Метод OPTIONS` позволяет клиенту запросить у сервера страницу и получить методы и заголовки, которые можно на ней использовать. 

### Коды состояний

В ответ на каждый запрос от сервера поступает ответ, содержащий строку состояния, а также, возможно, дополнительную информацию (например, веб-страницу или ее часть). Строка состояния может содержать трехразрядный код состояния, сообщающий об успешном выполнении запроса или о причинах неудачи. Первый разряд предназначен для разделения всех ответов на пять основных групп. 

- `Коды 1xx` - информационные, на практике используются редко. 
- `Коды 2xx` - означают, что запрос был обработан успешно и данные (если их запрашивали) отосланы. 
- `Коды 3xx` - сообщают клиенту о том, что нужно запросить данные в другом месте — используя либо другой URL, либо свой собственный кэш. 
- `Коды 4xx` - означают, что запрос по какой-либо причине, связанной с клиентом, потерпел неудачу: например, была запрошена несуществующая страница или сам запрос был некорректен. 
- `Коды 5xx` - сообщают о внутренних ошибках сервера, возникших либо вследствие ошибки программы, либо из-за временной перегрузки.

[Список кодов состояния HTTP ](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP)
