### ENGINE = ReplicatedMergeTree

**ReplicatedMergeTree** — это тип движка хранения в ClickHouse, который обеспечивает репликацию данных между несколькими узлами для повышения надежности и отказоустойчивости.

- **Replicated**: Указывает на поддержку репликации. Таблица будет автоматически реплицироваться на других узлах ClickHouse-кластера.
- **MergeTree**: Основной движок в ClickHouse, который поддерживает хранение данных в структурированном виде с возможностью эффективного выполнения запросов. Он предоставляет такие функции, как сортировка, индексирование, дедупликация и сжатие.

### PARTITION BY toYYYYMM(processed_at)

**PARTITION BY** — это оператор, который указывает, как разделить данные на партиции. Партиции позволяют эффективно управлять большими объемами данных, упрощая задачи управления и ускоряя запросы.
)
- **toYYYYMM(processed_at)**: Использует функцию `toYYYYMM`, чтобы преобразовать значение колонки `processed_at` в формат "ГГГГММ" (например, 202301 для января 2023 года). Таким образом, данные будут разбиты на партиции по месяцам. Это полезно для управления данными и выполнения запросов за определенные периоды времени.

### ORDER BY (source_id, tag_id, alarm_type, processed_at)

**ORDER BY** — это оператор, который определяет порядок сортировки данных в таблице.

- **(source_id, tag_id, alarm_type, processed_at)**: Указывает, что данные будут отсортированы по колонкам `source_id`, `tag_id`, `alarm_type` и `processed_at` в указанном порядке. Сортировка данных позволяет эффективно выполнять поиск и фильтрацию по этим колонкам, особенно если запросы часто содержат условия по этим полям.

### TTL toDateTime(processed_at) + INTERVAL 180 MONTH

**TTL** (Time to Live) — это настройка, которая автоматически удаляет старые данные по истечении указанного времени.

- **toDateTime(processed_at) + INTERVAL 180 MONTH**: Указывает, что данные будут удалены через 180 месяцев (15 лет) после значения в колонке `processed_at`. Таким образом, эта настройка помогает управлять временем жизни данных в таблице, автоматически удаляя устаревшую информацию и освобождая место.

### SETTINGS index_granularity = 8192

**SETTINGS** — это секция, которая позволяет указать дополнительные настройки для таблицы.

- **index_granularity = 8192**: Определяет, как часто будут создаваться индексы в таблице. Значение 8192 означает, что индекс будет создаваться каждые 8192 строк. Это влияет на баланс между объемом индексных данных и скоростью выполнения запросов: меньшая гранулярность (меньшее значение) приведет к более частому индексированию и более быстрому выполнению запросов, но увеличит объем индексных данных.

### Пример команды целиком


``` CREATE TABLE example_table (     source_id LowCardinality(String),     tag_id LowCardinality(String),     alarm_type LowCardinality(String),     processed_at DateTime,     value Float64 ) ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/example_table', '{replica}') PARTITION BY toYYYYMM(processed_at) ORDER BY (source_id, tag_id, alarm_type, processed_at) TTL toDateTime(processed_at) + INTERVAL 180 MONTH SETTINGS index_granularity = 8192;```

### Расшифровка в контексте

1. **ENGINE = ReplicatedMergeTree**: Использование движка с поддержкой репликации для повышения надежности и отказоустойчивости.
2. **PARTITION BY toYYYYMM(processed_at)**: Разбиение данных на месячные партиции по колонке `processed_at`.
3. **ORDER BY (source_id, tag_id, alarm_type, processed_at)**: Сортировка данных по колонкам `source_id`, `tag_id`, `alarm_type` и `processed_at`.
4. **TTL toDateTime(processed_at) + INTERVAL 180 MONTH**: Автоматическое удаление данных через 15 лет после даты их обработки.
5. **SETTINGS index_granularity = 8192**: Создание индексов каждые 8192 строки для оптимизации выполнения запросов.